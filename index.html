<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Handover Template</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      font-size: 13px;
      line-height: 1.4;
      background: #fff;
      position: relative;
    }
    /* Watermark */
    body::before {
      content: "ONCLUSIVE";
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-30deg);
      font-size: 120px;
      color: rgba(0, 128, 0, 0.08); /* light green */
      white-space: nowrap;
      z-index: -1; /* behind everything */
      pointer-events: none;
    }
    h2 {
      text-align: center;
      margin-bottom: 10px;
      color: black;
    }
    h3 {
      text-align: center;
      color: black;
      margin-top: 15px;
      margin-bottom: 8px;
    }
    table {
      width: 80%;
      margin: auto;
      border-collapse: collapse;
      margin-bottom: 8px;
      font-size: 13px;
      background: white;
    }
    th, td {
      border: 1px solid #444;
      padding: 4px 6px;
      text-align: left;
    }
    th {
      background-color: #c39bd3; /* medium-light purple */
      color: black;
      text-align: center;
    }
    .button {
      padding: 7px 11px;
      margin: 5px 3px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background-color: #6a0dad;
      color: white;
      font-size: 12px;
    }
    .button-group {
      text-align: center;
      margin-bottom: 20px;
    }
    #previewContent {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 12px;
      background: #f9f9f9;
      font-size: 13px;
    }
    select {
      margin: 5px;
      padding: 4px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <h2>Shift Handover Update</h2>

  <label for="shiftSelect">Select Shift:</label>
  <select id="shiftSelect">
    <option value="Morning">Morning</option>
    <option value="Afternoon">Afternoon</option>
    <option value="Night">Night</option>
  </select>
  <br>

  <label for="senderSelect">Select Sender:</label>
  <select id="senderSelect">
     <option value="Sankarshan Naik">Sankarshan Naik</option>
  <option value="Mitali Mokal">Mitali Mokal</option>
  <option value="Pratik Pawar">Pratik Pawar</option>
  <option value="Chandrasekhar Nookala">Chandrasekhar Nookala</option>
  <option value="Aditi Bafna">Aditi Bafna</option>
  <option value="Other">Other (Type Below)</option>
  </select>
  <input type="text" id="customSender" placeholder="Enter name" style="display:none; margin-left:5px;">

  <!-- TOP DMA Table -->
  <h3>TOP DMA</h3>
  <table id="dmaTable">
    <tr>
      <th>Ticket Link</th>
      <th>Description</th>
    </tr>
  </table>
  <div class="button-group">
    <button class="button" onclick="addRow('dmaTable')">Add TOP DMA Row</button>
    <button class="button" onclick="undoRow('dmaTable')">Undo TOP DMA Row</button>
  </div>

  <!-- Other Outstanding Issues Table -->
  <h3>Other Outstanding Issues</h3>
  <table id="issuesTable">
    <tr>
      <th>Ticket Link</th>
      <th>Description</th>
    </tr>
  </table>
  <div class="button-group">
    <button class="button" onclick="addRow('issuesTable')">Add Issue Row</button>
    <button class="button" onclick="undoRow('issuesTable')">Undo Issue Row</button>
  </div>

  <div class="button-group">
    <button class="button" onclick="previewHandover()">Preview Handover</button>
    <button class="button" onclick="copyHandover()">Copy Handover</button>
  </div>

  <div id="previewContent"></div>

  <script>
    // Format today's date like 21st-September-2025
    function formatDate() {
      const date = new Date();
      const day = date.getDate();
      const suffix = (day % 10 === 1 && day !== 11) ? "st" :
                     (day % 10 === 2 && day !== 12) ? "nd" :
                     (day % 10 === 3 && day !== 13) ? "rd" : "th";
      const months = [
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
      ];
      const month = months[date.getMonth()];
      const year = date.getFullYear();
      return `${day}${suffix}-${month}-${year}`;
    }

    // Show custom sender input if "Other" is selected
    document.getElementById("senderSelect").addEventListener("change", function() {
      const customInput = document.getElementById("customSender");
      if (this.value === "Other") {
        customInput.style.display = "inline-block";
      } else {
        customInput.style.display = "none";
      }
    });

    function addRow(tableId) {
      const table = document.getElementById(tableId);
      const row = table.insertRow(-1);
      const cell1 = row.insertCell(0);
      const cell2 = row.insertCell(1);
      cell1.innerHTML = '<input type="text" placeholder="Enter Ticket Link">';
      cell2.innerHTML = '<input type="text" placeholder="Enter Description">';
    }

    function undoRow(tableId) {
      const table = document.getElementById(tableId);
      if (table.rows.length > 1) {
        table.deleteRow(-1);
      }
    }

    function getTableHTML(tableId, title) {
      let table = document.getElementById(tableId);
      let rows = table.rows;
      let html = `<h3 style='text-align:center; color:black;'>${title}</h3>`;
      html += "<table style='width:80%; margin:auto; border-collapse:collapse; font-size:13px; background:white;'>";
      html += "<tr style='background-color:#c39bd3; color:black; text-align:center;'><th>Ticket Link</th><th>Description</th></tr>";
      for (let i = 1; i < rows.length; i++) {
        let ticketLink = rows[i].cells[0].querySelector("input").value || "";
        let desc = rows[i].cells[1].querySelector("input").value || "";
        if (ticketLink || desc) {
          html += `<tr><td><a href="${ticketLink}" target="_blank">${ticketLink}</a></td><td>${desc}</td></tr>`;
        }
      }
      html += "</table>";
      return html;
    }

    function previewHandover() {
      const shift = document.getElementById("shiftSelect").value;
      const senderDropdown = document.getElementById("senderSelect").value;
      const customSender = document.getElementById("customSender").value;
      const sender = senderDropdown === "Other" ? customSender : senderDropdown;
      const today = formatDate();

      let html = `<p>Hello Team,</p>
        <p>Here's the End of shift update for <b>${shift}</b> shift on <b>${today}</b>.</p>`;
      html += getTableHTML("dmaTable", "TOP DMA");
      html += getTableHTML("issuesTable", "Other Outstanding Issues");
      html += `<p>Regards,<br>${sender}</p>`;

      document.getElementById("previewContent").innerHTML = html;
    }

    function copyHandover() {
      const previewDiv = document.getElementById("previewContent");
      const range = document.createRange();
      range.selectNodeContents(previewDiv);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand("copy");
        alert("Handover copied to clipboard!");
      } catch (err) {
        alert("Failed to copy handover.");
      }
      selection.removeAllRanges();
    }
  </script>
</body>
</html>
