<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Handover Template</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; font-size: 14px; }
    h2 { text-align: center; color: black; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #c8a2f0; color: black; }
    button { margin: 5px 0; padding: 6px 12px; border: none; border-radius: 4px; background: #6c63ff; color: white; cursor: pointer; }
    button:hover { background: #574b90; }
    #preview { border: 1px solid #ccc; padding: 10px; margin-top: 20px; background: #fafafa; }
    select { padding: 4px; margin-bottom: 10px; }
  </style>
</head>
<body>

  <h2>Shift Handover</h2>

  <label for="shift">Select Shift:</label>
  <select id="shift">
    <option value="Morning">Morning Shift</option>
    <option value="Afternoon">Afternoon Shift</option>
    <option value="Night">Night Shift</option>
  </select>

  <br><br>

  <label for="sender">Select Sender:</label>
  <select id="sender">
    <option value="Sankarshan Naik">Sankarshan Naik</option>
    <option value="Mitali Mokal">Mitali Mokal</option>
  <option value="Pratik Pawar">Pratik Pawar</option>
  <option value="Chandrasekhar Nookala">Chandrasekhar Nookala</option>

  </select>

  <h2>TOP DMA</h2>
  <table id="dmaTable">
    <thead>
      <tr>
        <th>Ticket Link</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="addTopDmaRow()">Add Top DMA</button>
  <button onclick="undoLastChange('dmaTable')">Undo Last Change</button>

  <h2>Other Outstanding Issues</h2>
  <table id="outstandingTable">
    <thead>
      <tr>
        <th>Ticket Link</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="addOutstandingRow()">Add Outstanding Issue</button>
  <button onclick="undoLastChange('outstandingTable')">Undo Last Change</button>

  <br><br>
  <button onclick="previewHandover()">Preview</button>
  <button onclick="copyToClipboard()">Copy Handover</button>

  <div id="preview"></div>

  <script>
    let history = { dmaTable: [], outstandingTable: [] };

    // Add new row for Top DMA
    function addTopDmaRow() {
      const table = document.getElementById("dmaTable").getElementsByTagName('tbody')[0];
      saveHistory("dmaTable");
      const newRow = table.insertRow();

      const linkCell = newRow.insertCell(0);
      const descCell = newRow.insertCell(1);

      linkCell.innerHTML = '<input type="text" placeholder="Enter Ticket Link" onblur="makeLink(this)">';
      descCell.innerHTML = '<input type="text" placeholder="Enter Description">';
    }

    // Add new row for Outstanding Issues
    function addOutstandingRow() {
      const table = document.getElementById("outstandingTable").getElementsByTagName('tbody')[0];
      saveHistory("outstandingTable");
      const newRow = table.insertRow();

      const linkCell = newRow.insertCell(0);
      const descCell = newRow.insertCell(1);

      linkCell.innerHTML = '<input type="text" placeholder="Enter Ticket Link" onblur="makeLink(this)">';
      descCell.innerHTML = '<input type="text" placeholder="Enter Description">';
    }

    // Convert ticket link to clickable hyperlink
    function makeLink(input) {
      if (input.value.trim() !== "") {
        const url = input.value.trim();
        input.parentElement.innerHTML = `<a href="${url}" target="_blank">${url}</a>`;
      }
    }

    // Save table state for undo
    function saveHistory(tableId) {
      const table = document.getElementById(tableId).getElementsByTagName('tbody')[0];
      history[tableId].push(table.innerHTML);
    }

    // Undo last change
    function undoLastChange(tableId) {
      if (history[tableId].length > 0) {
        const table = document.getElementById(tableId).getElementsByTagName('tbody')[0];
        table.innerHTML = history[tableId].pop();
      }
    }

    // Preview the handover
    function previewHandover() {
      const shift = document.getElementById("shift").value;
      const sender = document.getElementById("sender").value;
      const dmaTable = document.getElementById("dmaTable").outerHTML;
      const outstandingTable = document.getElementById("outstandingTable").outerHTML;

      const today = new Date().toLocaleDateString();

      const content = `
        <p>Hello Team,</p>
        <p>Here's the End of shift update for ${shift} on <b>${today}</b>:</p>
        ${dmaTable}
        ${outstandingTable}
        <p>Regards,<br>${sender}</p>
      `;

      document.getElementById("preview").innerHTML = content;
    }

    // Copy to clipboard
    function copyToClipboard() {
      previewHandover();
      const range = document.createRange();
      range.selectNode(document.getElementById("preview"));
      window.getSelection().removeAllRanges();
      window.getSelection().addRange(range);
      document.execCommand("copy");
      window.getSelection().removeAllRanges();
      alert("Handover copied to clipboard!");
    }
  </script>
</body>
</html>
